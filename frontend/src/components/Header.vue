<template>
  <header
    class="relative w-full bg-gradient-to-b from-[#BAA089] to-[#E8CEB7] text-white px-6 py-4 flex items-center justify-between transition-colors duration-300"
  >
    <div class="flex items-center">
      <button
        @click="showMenu = !showMenu"
        class="md:hidden p-2 focus:outline-none"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
             viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
     <img src="/logo.png" alt="Matchroom" class="hidden md:block ml-5 mt-1 w-20  duration-200 hover:scale-105 cursor-pointer" @click="router.push('/')" />
  </div>
		<nav class="hidden md:flex items-center space-x-6 text-sm md:text-base">
			<button @click="toggleDarkMode">
				<span v-if="isDark"
					><svg
						width="30"
						height="31"
						viewBox="0 0 30 31"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M15.668 24.0782C13.4147 24.0782 11.2536 23.1831 9.66032 21.5898C8.067 19.9964 7.17188 17.8354 7.17188 15.5821C7.17187 12.1397 9.14941 9.05331 12.2113 7.72067C12.3192 7.67364 12.4388 7.6602 12.5544 7.68211C12.6701 7.70402 12.7765 7.76026 12.8597 7.84349C12.943 7.92673 12.9992 8.03311 13.0211 8.14877C13.043 8.26443 13.0296 8.384 12.9825 8.49191C12.631 9.29904 12.4453 10.3329 12.4453 11.4806C12.4453 15.5191 15.731 18.8048 19.7695 18.8048C20.9172 18.8048 21.951 18.6191 22.7582 18.2675C22.8661 18.2205 22.9857 18.2071 23.1013 18.229C23.217 18.2509 23.3234 18.3071 23.4066 18.3904C23.4898 18.4736 23.5461 18.58 23.568 18.6956C23.5899 18.8113 23.5765 18.9309 23.5294 19.0388C22.1968 22.1007 19.1104 24.0782 15.668 24.0782Z"
							fill="white"
						/>
					</svg>
				</span>
				<span v-else
					><svg
						width="30"
						height="31"
						viewBox="0 0 30 31"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M15.1982 24.792C15.2539 24.7921 15.3078 24.8085 15.3535 24.8389L15.3965 24.874C15.4492 24.9268 15.4795 24.9987 15.4795 25.0732V26.1143C15.4795 26.1702 15.4622 26.2246 15.4316 26.2705L15.3965 26.3135C15.3438 26.366 15.2726 26.3954 15.1982 26.3955C15.1423 26.3955 15.0878 26.3792 15.042 26.3486L14.999 26.3135C14.9463 26.2607 14.917 26.1889 14.917 26.1143V25.0732C14.917 24.9987 14.9463 24.9268 14.999 24.874C15.0518 24.8213 15.1237 24.792 15.1982 24.792ZM8.24121 22.373C8.27809 22.3731 8.31456 22.3804 8.34863 22.3945C8.36577 22.4016 8.38212 22.4106 8.39746 22.4209L8.44043 22.4551C8.49306 22.5078 8.52246 22.5798 8.52246 22.6543C8.52243 22.7104 8.50534 22.7646 8.47461 22.8105L8.44043 22.8525L8.01855 23.2744C8.0058 23.2881 7.99169 23.3007 7.97656 23.3115L7.92773 23.3398C7.89323 23.3552 7.85514 23.3636 7.81738 23.3643L7.76172 23.3594L7.70703 23.3438C7.68954 23.3367 7.67287 23.3278 7.65723 23.3174L7.61426 23.2822C7.60089 23.2689 7.5885 23.254 7.57812 23.2383L7.55176 23.1885C7.53762 23.1535 7.53059 23.1159 7.53125 23.0781C7.53158 23.0594 7.53407 23.0407 7.53809 23.0225L7.55566 22.9688C7.57103 22.9343 7.59346 22.9027 7.62109 22.877L7.62793 22.8711L7.63379 22.8643L8.04297 22.4551L8.04199 22.4541C8.05486 22.4413 8.06994 22.4309 8.08496 22.4209L8.13379 22.3945C8.16785 22.3805 8.20435 22.373 8.24121 22.373ZM22.1543 22.374C22.2103 22.374 22.2647 22.3902 22.3105 22.4209L22.3525 22.4561L22.7617 22.8652L22.7686 22.8711L22.7744 22.877C22.802 22.9027 22.8245 22.9343 22.8398 22.9688C22.8475 22.9861 22.8534 23.0041 22.8574 23.0225L22.8643 23.0781C22.8646 23.0968 22.8627 23.1155 22.8594 23.1338L22.8438 23.1885C22.8296 23.2235 22.8089 23.2556 22.7822 23.2822C22.7689 23.2955 22.7539 23.307 22.7383 23.3174L22.6885 23.3438C22.6535 23.3579 22.6159 23.3649 22.5781 23.3643L22.5225 23.3574C22.5041 23.3534 22.4861 23.3475 22.4688 23.3398C22.4343 23.3245 22.4027 23.302 22.377 23.2744L22.3711 23.2686L22.3652 23.2617L21.9561 22.8525C21.9035 22.7998 21.8741 22.7287 21.874 22.6543C21.874 22.5801 21.9029 22.5087 21.9551 22.4561C22.0078 22.4034 22.0798 22.374 22.1543 22.374ZM4.78125 15.417H5.82324C5.89764 15.4171 5.96883 15.4465 6.02148 15.499C6.07423 15.5518 6.10449 15.6237 6.10449 15.6982C6.10443 15.754 6.08709 15.8078 6.05664 15.8535L6.02148 15.8965C5.96882 15.9492 5.89772 15.9794 5.82324 15.9795H4.78125C4.7252 15.9795 4.67093 15.9623 4.625 15.9316L4.58203 15.8965C4.52957 15.8438 4.50009 15.7726 4.5 15.6982C4.5 15.6237 4.52939 15.5518 4.58203 15.499C4.63478 15.4463 4.70666 15.417 4.78125 15.417ZM24.5732 15.417H25.6143C25.6702 15.417 25.7247 15.4333 25.7705 15.4639L25.8135 15.499C25.8662 15.5518 25.8955 15.6237 25.8955 15.6982C25.8954 15.7539 25.879 15.8078 25.8486 15.8535L25.8135 15.8965C25.7607 15.9492 25.6889 15.9795 25.6143 15.9795H24.5732C24.5173 15.9795 24.4629 15.9622 24.417 15.9316L24.374 15.8965C24.3215 15.8438 24.2921 15.7726 24.292 15.6982C24.292 15.6237 24.3213 15.5518 24.374 15.499C24.4268 15.4463 24.4987 15.417 24.5732 15.417ZM7.83203 8.05176C7.88789 8.05176 7.94245 8.06813 7.98828 8.09863L8.03125 8.13379L8.44043 8.54297C8.47546 8.58167 8.49928 8.62894 8.50879 8.67969L8.51367 8.7334C8.51322 8.78862 8.49605 8.84243 8.46582 8.8877L8.43066 8.93066C8.37858 8.98262 8.30795 9.01202 8.23438 9.0127C8.16073 9.0133 8.09011 8.98474 8.03711 8.93359H8.03613L7.63379 8.53125C7.58112 8.47852 7.55176 8.40656 7.55176 8.33203C7.55181 8.27639 7.56831 8.22245 7.59863 8.17676L7.63379 8.13379C7.68644 8.08132 7.7577 8.05183 7.83203 8.05176ZM22.5635 8.05176C22.6376 8.05176 22.7091 8.08069 22.7617 8.13281V8.13379C22.8143 8.18646 22.8437 8.25762 22.8438 8.33203C22.8438 8.38796 22.8274 8.44242 22.7969 8.48828L22.7617 8.53125L22.3652 8.92773C22.312 8.97736 22.2417 9.00415 22.1689 9.00293L22.1152 8.99707C22.0799 8.98957 22.0465 8.97526 22.0166 8.95508L21.9746 8.9209C21.9361 8.88234 21.9097 8.83378 21.8984 8.78125L21.8926 8.72754C21.8913 8.6565 21.9165 8.58699 21.9639 8.53418L22.3652 8.13379C22.4179 8.08133 22.4891 8.05177 22.5635 8.05176ZM15.1982 5C15.2539 5.00006 15.3078 5.01655 15.3535 5.04688L15.3965 5.08203C15.4492 5.13478 15.4795 5.20666 15.4795 5.28125V6.32324C15.4794 6.379 15.4621 6.43277 15.4316 6.47852L15.3965 6.52148C15.3438 6.57415 15.2727 6.60441 15.1982 6.60449C15.1237 6.60449 15.0518 6.57423 14.999 6.52148C14.9465 6.46883 14.9171 6.39764 14.917 6.32324V5.28125C14.917 5.20666 14.9463 5.13478 14.999 5.08203C15.0518 5.02939 15.1237 5 15.1982 5Z"
							stroke="#F8F8F8"
						/>
						<path
							d="M15.1973 9.94824C16.6269 9.94824 18.0019 10.4805 19.0566 11.4355L19.2627 11.6328C20.341 12.7111 20.9473 14.1732 20.9473 15.6982C20.9473 17.1279 20.415 18.5028 19.46 19.5576L19.2627 19.7637C18.1844 20.842 16.7223 21.4482 15.1973 21.4482C13.7676 21.4482 12.3927 20.916 11.3379 19.9609L11.1318 19.7637C10.0535 18.6853 9.44727 17.2232 9.44727 15.6982C9.44727 14.1732 10.0535 12.7111 11.1318 11.6328C12.1428 10.6219 13.4909 10.0256 14.9121 9.95508L15.1973 9.94824Z"
							stroke="#F8F8F8"
						/>
					</svg>
				</span>
			</button>

			<!-- Affiche la photo si connecté, sinon le bouton -->
			<template v-if="isAuthenticated">
				<img
					src="@/assets/logo.png"
					alt="Profil"
					class="w-9 h-9 rounded-full object-cover border-2 border-white shadow"
				/>
				<!-- Bouton Déconnexion -->
				<button
					@click="logout"
				>
					Se déconnecter
				</button>
			</template>
			<template v-else>
				<router-link to="/signin" class="hover:underline"
					>Se connecter</router-link
				>
			</template>
		</nav>

		<!-- mobile quick actions: DarkMode + Se connecter -->
		<div class="flex items-center space-x-4 md:hidden">
			<button @click="toggleDarkMode">
				<span v-if="isDark"
					><svg
						width="30"
						height="31"
						viewBox="0 0 30 31"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M15.668 24.0782C13.4147 24.0782 11.2536 23.1831 9.66032 21.5898C8.067 19.9964 7.17188 17.8354 7.17188 15.5821C7.17187 12.1397 9.14941 9.05331 12.2113 7.72067C12.3192 7.67364 12.4388 7.6602 12.5544 7.68211C12.6701 7.70402 12.7765 7.76026 12.8597 7.84349C12.943 7.92673 12.9992 8.03311 13.0211 8.14877C13.043 8.26443 13.0296 8.384 12.9825 8.49191C12.631 9.29904 12.4453 10.3329 12.4453 11.4806C12.4453 15.5191 15.731 18.8048 19.7695 18.8048C20.9172 18.8048 21.951 18.6191 22.7582 18.2675C22.8661 18.2205 22.9857 18.2071 23.1013 18.229C23.217 18.2509 23.3234 18.3071 23.4066 18.3904C23.4898 18.4736 23.5461 18.58 23.568 18.6956C23.5899 18.8113 23.5765 18.9309 23.5294 19.0388C22.1968 22.1007 19.1104 24.0782 15.668 24.0782Z"
							fill="white"
						/>
					</svg>
				</span>
				<span v-else
					><svg
						width="30"
						height="31"
						viewBox="0 0 30 31"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M15.1982 24.792C15.2539 24.7921 15.3078 24.8085 15.3535 24.8389L15.3965 24.874C15.4492 24.9268 15.4795 24.9987 15.4795 25.0732V26.1143C15.4795 26.1702 15.4622 26.2246 15.4316 26.2705L15.3965 26.3135C15.3438 26.366 15.2726 26.3954 15.1982 26.3955C15.1423 26.3955 15.0878 26.3792 15.042 26.3486L14.999 26.3135C14.9463 26.2607 14.917 26.1889 14.917 26.1143V25.0732C14.917 24.9987 14.9463 24.9268 14.999 24.874C15.0518 24.8213 15.1237 24.792 15.1982 24.792ZM8.24121 22.373C8.27809 22.3731 8.31456 22.3804 8.34863 22.3945C8.36577 22.4016 8.38212 22.4106 8.39746 22.4209L8.44043 22.4551C8.49306 22.5078 8.52246 22.5798 8.52246 22.6543C8.52243 22.7104 8.50534 22.7646 8.47461 22.8105L8.44043 22.8525L8.01855 23.2744C8.0058 23.2881 7.99169 23.3007 7.97656 23.3115L7.92773 23.3398C7.89323 23.3552 7.85514 23.3636 7.81738 23.3643L7.76172 23.3594L7.70703 23.3438C7.68954 23.3367 7.67287 23.3278 7.65723 23.3174L7.61426 23.2822C7.60089 23.2689 7.5885 23.254 7.57812 23.2383L7.55176 23.1885C7.53762 23.1535 7.53059 23.1159 7.53125 23.0781C7.53158 23.0594 7.53407 23.0407 7.53809 23.0225L7.55566 22.9688C7.57103 22.9343 7.59346 22.9027 7.62109 22.877L7.62793 22.8711L7.63379 22.8643L8.04297 22.4551L8.04199 22.4541C8.05486 22.4413 8.06994 22.4309 8.08496 22.4209L8.13379 22.3945C8.16785 22.3805 8.20435 22.373 8.24121 22.373ZM22.1543 22.374C22.2103 22.374 22.2647 22.3902 22.3105 22.4209L22.3525 22.4561L22.7617 22.8652L22.7686 22.8711L22.7744 22.877C22.802 22.9027 22.8245 22.9343 22.8398 22.9688C22.8475 22.9861 22.8534 23.0041 22.8574 23.0225L22.8643 23.0781C22.8646 23.0968 22.8627 23.1155 22.8594 23.1338L22.8438 23.1885C22.8296 23.2235 22.8089 23.2556 22.7822 23.2822C22.7689 23.2955 22.7539 23.307 22.7383 23.3174L22.6885 23.3438C22.6535 23.3579 22.6159 23.3649 22.5781 23.3643L22.5225 23.3574C22.5041 23.3534 22.4861 23.3475 22.4688 23.3398C22.4343 23.3245 22.4027 23.302 22.377 23.2744L22.3711 23.2686L22.3652 23.2617L21.9561 22.8525C21.9035 22.7998 21.8741 22.7287 21.874 22.6543C21.874 22.5801 21.9029 22.5087 21.9551 22.4561C22.0078 22.4034 22.0798 22.374 22.1543 22.374ZM4.78125 15.417H5.82324C5.89764 15.4171 5.96883 15.4465 6.02148 15.499C6.07423 15.5518 6.10449 15.6237 6.10449 15.6982C6.10443 15.754 6.08709 15.8078 6.05664 15.8535L6.02148 15.8965C5.96882 15.9492 5.89772 15.9794 5.82324 15.9795H4.78125C4.7252 15.9795 4.67093 15.9623 4.625 15.9316L4.58203 15.8965C4.52957 15.8438 4.50009 15.7726 4.5 15.6982C4.5 15.6237 4.52939 15.5518 4.58203 15.499C4.63478 15.4463 4.70666 15.417 4.78125 15.417ZM24.5732 15.417H25.6143C25.6702 15.417 25.7247 15.4333 25.7705 15.4639L25.8135 15.499C25.8662 15.5518 25.8955 15.6237 25.8955 15.6982C25.8954 15.7539 25.879 15.8078 25.8486 15.8535L25.8135 15.8965C25.7607 15.9492 25.6889 15.9795 25.6143 15.9795H24.5732C24.5173 15.9795 24.4629 15.9622 24.417 15.9316L24.374 15.8965C24.3215 15.8438 24.2921 15.7726 24.292 15.6982C24.292 15.6237 24.3213 15.5518 24.374 15.499C24.4268 15.4463 24.4987 15.417 24.5732 15.417ZM7.83203 8.05176C7.88789 8.05176 7.94245 8.06813 7.98828 8.09863L8.03125 8.13379L8.44043 8.54297C8.47546 8.58167 8.49928 8.62894 8.50879 8.67969L8.51367 8.7334C8.51322 8.78862 8.49605 8.84243 8.46582 8.8877L8.43066 8.93066C8.37858 8.98262 8.30795 9.01202 8.23438 9.0127C8.16073 9.0133 8.09011 8.98474 8.03711 8.93359H8.03613L7.63379 8.53125C7.58112 8.47852 7.55176 8.40656 7.55176 8.33203C7.55181 8.27639 7.56831 8.22245 7.59863 8.17676L7.63379 8.13379C7.68644 8.08132 7.7577 8.05183 7.83203 8.05176ZM22.5635 8.05176C22.6376 8.05176 22.7091 8.08069 22.7617 8.13281V8.13379C22.8143 8.18646 22.8437 8.25762 22.8438 8.33203C22.8438 8.38796 22.8274 8.44242 22.7969 8.48828L22.7617 8.53125L22.3652 8.92773C22.312 8.97736 22.2417 9.00415 22.1689 9.00293L22.1152 8.99707C22.0799 8.98957 22.0465 8.97526 22.0166 8.95508L21.9746 8.9209C21.9361 8.88234 21.9097 8.83378 21.8984 8.78125L21.8926 8.72754C21.8913 8.6565 21.9165 8.58699 21.9639 8.53418L22.3652 8.13379C22.4179 8.08133 22.4891 8.05177 22.5635 8.05176ZM15.1982 5C15.2539 5.00006 15.3078 5.01655 15.3535 5.04688L15.3965 5.08203C15.4492 5.13478 15.4795 5.20666 15.4795 5.28125V6.32324C15.4794 6.379 15.4621 6.43277 15.4316 6.47852L15.3965 6.52148C15.3438 6.57415 15.2727 6.60441 15.1982 6.60449C15.1237 6.60449 15.0518 6.57423 14.999 6.52148C14.9465 6.46883 14.9171 6.39764 14.917 6.32324V5.28125C14.917 5.20666 14.9463 5.13478 14.999 5.08203C15.0518 5.02939 15.1237 5 15.1982 5Z"
							stroke="#F8F8F8"
						/>
						<path
							d="M15.1973 9.94824C16.6269 9.94824 18.0019 10.4805 19.0566 11.4355L19.2627 11.6328C20.341 12.7111 20.9473 14.1732 20.9473 15.6982C20.9473 17.1279 20.415 18.5028 19.46 19.5576L19.2627 19.7637C18.1844 20.842 16.7223 21.4482 15.1973 21.4482C13.7676 21.4482 12.3927 20.916 11.3379 19.9609L11.1318 19.7637C10.0535 18.6853 9.44727 17.2232 9.44727 15.6982C9.44727 14.1732 10.0535 12.7111 11.1318 11.6328C12.1428 10.6219 13.4909 10.0256 14.9121 9.95508L15.1973 9.94824Z"
							stroke="#F8F8F8"
						/>
					</svg>
				</span>
			</button>
			<template v-if="isAuthenticated">
				<img
					src="@/assets/logo.png"
					alt="Profil"
					class="w-8 h-8 rounded-full object-cover border-2 border-white shadow"
				/>
				<button
					@click="logout"
				>
					Se déconnecter
				</button>
			</template>
			<template v-else>
				<router-link to="/signin" class="hover:underline text-sm"
					>Se connecter</router-link
				>
			</template>
		</div>

		<!-- mobile slide-out menu with overlay -->
		<transition name="fade">
			<div v-if="showMenu" class="fixed inset-0 flex z-50">
				<!-- slide-out drawer -->
				<nav class="w-3/5 h-screen bg-gradient-to-r from-[#BAA089] to-[#E8CEB7] flex flex-col p-6">
           <button @click="showMenu = false" class="self-end mb-6 p-2 focus:outline-none">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                     d="M6 18L18 6M6 6l12 12"/>
             </svg>
           </button>
           <a href="#" class="block py-2 hover:underline">Accueil</a>
           <a href="#" class="block py-2 hover:underline">A propos</a>
           <a href="#" class="block py-2 hover:underline">FAQ</a>
         </nav>

				<!-- overlay to blur and close menu on click -->
				<div
					@click="showMenu = false"
					class="w-2/5 h-screen backdrop-blur-sm"
				></div>
			</div>
		</transition>
	</header>
</template>

<script setup>
	import { ref, computed, onMounted } from "vue";
	import { useRouter } from "vue-router";

	const props = defineProps({
		isDark: Boolean,
		toggleDarkMode: Function,
	});

	const showMenu = ref(false);
	const user = ref(null);
	const router = useRouter();

	// Fonction pour décoder le JWT
	function parseJwt(token) {
		if (!token) return null;
		try {
			const base64Url = token.split(".")[1];
			const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
			const jsonPayload = decodeURIComponent(
				atob(base64)
					.split("")
					.map(function (c) {
						return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
					})
					.join("")
			);
			return JSON.parse(jsonPayload);
		} catch (e) {
			return null;
		}
	}

	onMounted(() => {
		const token = localStorage.getItem("authToken");
		if (token) {
			const payload = parseJwt(token);
			user.value = {
				id: payload?.id,
				email: payload?.email,
				role: payload?.role,
			};
		}
	});

	const isAuthenticated = computed(() => !!localStorage.getItem("authToken"));

	function logout() {
		localStorage.removeItem("authToken");
		user.value = null;
    router.push("/").then(() => {
      window.location.reload();
    });
	}
</script>

<style>
	.fade-enter-active,
	.fade-leave-active {
		transition: opacity 0.2s;
	}
	.fade-enter-from,
	.fade-leave-to {
		opacity: 0;
	}
</style>
